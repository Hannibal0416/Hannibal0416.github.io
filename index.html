<!DOCTYPE html>
<html lang="en">
	<head>
		<title>美境冷氣外掛方案</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<link rel="stylesheet" type="text/css" href="css/jquery.fancybox.css" />
		<link rel="stylesheet" type="text/css" href="css/jquery.fancybox-thumbs.css" />
		<style>
			body {
				color: #000;
				font-family:Monospace;
				font-size:13px;
				text-align:center;
				font-weight: bold;

				background-color: #fff;
				margin: 0px;
				overflow: hidden;
			}

			
		</style>
		<script type="text/javascript" src="js/jquery-1.10.1.min.js"></script>
		<script type="text/javascript" src="js/jquery.fancybox.js"></script>
		<script type="text/javascript" src="js/jquery.fancybox-thumbs.js"></script>
		<script src='js/vender/three.min.js'></script>
		<script src='js/vender/Projector.js'></script>
		<script src="js/OrbitControls.js"></script>
		<script src="js/Detector.js"></script>
		<script src="js/stats.min.js"></script>
		<script src="js/threex.domevents.js"></script>
	</head>

	<body>
		<div id="container"></div>
		

		<!--<script src="js/three.js"></script>
		<script src='js/Projector.js'></script>-->
	
		
		<script>

			if ( ! Detector.webgl ) Detector.addGetWebGLMessage();

			var stats;
			var camera, controls, scene, renderer,raycaster,mouse;
			var objects = [];
			init();
			animate();
			var meshA1,meshA2,meshA3,book,titleMesh;
			var stop = false;

			showImg();
			function init() {
				raycaster = new THREE.Raycaster();
				mouse = new THREE.Vector2();
				scene = new THREE.Scene();
				scene.fog = new THREE.FogExp2( 0xcccccc, 0.002 );

				renderer = new THREE.WebGLRenderer();
				renderer.setClearColor( scene.fog.color );
				renderer.setPixelRatio( window.devicePixelRatio );
				renderer.setSize( window.innerWidth, window.innerHeight );

				var container = document.getElementById( 'container' );
				container.appendChild( renderer.domElement );

				camera = new THREE.PerspectiveCamera( 10, window.innerWidth / window.innerHeight, 1, 10000 );
				camera.position.z = 15;
				camera.position.y = 5;

				controls = new THREE.OrbitControls( camera, renderer.domElement );
				//controls.addEventListener( 'change', render ); // add this only if there is no animation loop (requestAnimationFrame)
				controls.enableDamping = true;
				controls.dampingFactor = 0.25;
				controls.enableZoom = true;

				var loader = new THREE.JSONLoader();
				
			    loader.load('json/A1.json', function(geometry, materials) {
			        meshA1 = new THREE.Mesh(geometry, new THREE.MeshFaceMaterial(materials));
			        meshA1.scale.x = meshA1.scale.y = meshA1.scale.z = 0.75;
			        meshA1.translation = THREE.GeometryUtils.center(geometry);
			        meshA1.position.setX(1.2);
			        meshA1.callback =function() {
			        	console.log('A1');
			        	stop = true;
			        };
			        meshA1.callback2 =function() {
			        	console.log('A1 stop');
			        	stop = false;
			        }
			        scene.add(meshA1);
			        objects.push(meshA1);
			    });

			    loader.load('json/title.json', function(geometry, materials) {
			        titleMesh = new THREE.Mesh(geometry, new THREE.MeshFaceMaterial(materials));
			        titleMesh.scale.x = titleMesh.scale.y = titleMesh.scale.z = 0.55;
			        titleMesh.translation = THREE.GeometryUtils.center(geometry);
			        titleMesh.position.setY(1.2);
			        titleMesh.callback =function() {
			        	console.log('title');
			        	stop = true;
			        };
			       
			        scene.add(titleMesh);
			        objects.push(titleMesh);
			    });

			    loader.load('json/A2.json', function(geometry, materials) {
			        meshA2 = new THREE.Mesh(geometry, new THREE.MeshFaceMaterial(materials));
			        meshA2.scale.x = meshA2.scale.y = meshA2.scale.z = 0.75;
			        meshA2.translation = THREE.GeometryUtils.center(geometry);
			        meshA2.callback =function() {
			        	console.log('A2');
			        }
			        scene.add(meshA2);
			        objects.push(meshA2);

			    });


			    loader.load('json/book.json', function(geometry, materials) {
			        book = new THREE.Mesh(geometry, new THREE.MeshFaceMaterial(materials));
			        book.scale.x = book.scale.y = book.scale.z =0.1;
			        book.translation = THREE.GeometryUtils.center(geometry);
			        book.rotation.x -=5.5;
			        book.position.setY(0.8);

			        book.callback =function() {
			        	showImg();
				     }
			        scene.add(book);
			        objects.push(book);

			    });

				// lights

				light = new THREE.DirectionalLight( 0xffffff );
				light.position.set( 1, 3, 1 );
				scene.add( light );

				light = new THREE.DirectionalLight( 0xffffff );
				light.position.set( 1, 5, 1 );
				scene.add( light );

				light = new THREE.DirectionalLight( 0x111111 );
				light.position.set( -1, -1, -1 );
				scene.add( light );

				light = new THREE.AmbientLight( 0x222222 );
				scene.add( light );
				light = new THREE.SpotLight( 0xffffff, 0.5, 0.0, 180, 20 );
				scene.add( light );
				light = new THREE.SpotLight( 0xffffff, 0.5, 0.0, 180, 20 );
				light.position.set( 1, 5, 1 );
				scene.add( light );
				//

				stats = new Stats();
				//container.appendChild( stats.dom );

				window.addEventListener( 'mousedown', onDocumentMouseDown, false );
				window.addEventListener( 'mouseup', onDocumentMouseUp, false );
				window.addEventListener( 'resize', onWindowResize, false );

			}

			function showImg(){
				$.fancybox.open([
					{
						href : 'img/a1cad.jpg',
						title : 'A1外掛'
					}, {
						href : 'img/A1外掛.jpg',
						title : 'A1外掛'
					}, {
						href : 'img/A1洗洞.jpg',
						title : 'A1洗洞'
					}
				],{
					helpers : {
						thumbs : {
							width: 50,
							height: 50
						}
					}
				}); 
			}

			function onDocumentMouseDown( event ) {

			    event.preventDefault();

			    mouse.x = ( event.clientX / renderer.domElement.clientWidth ) * 2 - 1;
			    mouse.y = - ( event.clientY / renderer.domElement.clientHeight ) * 2 + 1;

			    raycaster.setFromCamera( mouse, camera );

			    var intersects = raycaster.intersectObjects( objects ); 

			    if ( intersects.length > 0 ) {

			        intersects[0].object.callback();

			    }

			}

			function onDocumentMouseUp( event ) {

			    event.preventDefault();

			    mouse.x = ( event.clientX / renderer.domElement.clientWidth ) * 2 - 1;
			    mouse.y = - ( event.clientY / renderer.domElement.clientHeight ) * 2 + 1;

			    raycaster.setFromCamera( mouse, camera );

			    var intersects = raycaster.intersectObjects( objects ); 

			    if ( intersects.length > 0 ) {

			        intersects[0].object.callback2();

			    }

			}

			function onWindowResize() {

				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();

				renderer.setSize( window.innerWidth, window.innerHeight );

			}

			function rotateMesh() {
			    if (!book) {
			        return;
			    }
			    if (stop == false) {
			    	book.rotation.x -= 0.015;
			    	book.rotation.y -= 0.015;
			    	book.rotation.z -= 0.015;
			    }

			   

			}

			function animate() {

				requestAnimationFrame( animate );

				controls.update(); // required if controls.enableDamping = true, or if controls.autoRotate = true

				stats.update();
				render();

			}

			function render() {
				rotateMesh();
				renderer.render( scene, camera );

			}

		</script>

	</body>
</html>
